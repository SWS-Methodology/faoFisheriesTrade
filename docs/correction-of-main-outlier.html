<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 5 Correction of main outlier | Fishery: Trade Module</title>
  <meta name="description" content="Fisheries Trade Documentation">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 5 Correction of main outlier | Fishery: Trade Module" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Fisheries Trade Documentation" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Correction of main outlier | Fishery: Trade Module" />
  
  <meta name="twitter:description" content="Fisheries Trade Documentation" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="outlier-detection-in-the-aggregated-level.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="ess.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="sec-intro.html"><a href="sec-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="sec-workflow.html"><a href="sec-workflow.html"><i class="fa fa-check"></i><b>2</b> Trade data Workflow</a><ul>
<li class="chapter" data-level="2.1" data-path="sec-workflow.html"><a href="sec-workflow.html#get-started-data"><i class="fa fa-check"></i><b>2.1</b> Get started data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data</a></li>
<li class="chapter" data-level="4" data-path="outlier-detection-in-the-aggregated-level.html"><a href="outlier-detection-in-the-aggregated-level.html"><i class="fa fa-check"></i><b>4</b> Outlier detection in the aggregated level</a><ul>
<li class="chapter" data-level="4.1" data-path="outlier-detection-in-the-aggregated-level.html"><a href="outlier-detection-in-the-aggregated-level.html#boxplot"><i class="fa fa-check"></i><b>4.1</b> Boxplot</a><ul>
<li class="chapter" data-level="4.1.1" data-path="outlier-detection-in-the-aggregated-level.html"><a href="outlier-detection-in-the-aggregated-level.html#example"><i class="fa fa-check"></i><b>4.1.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="outlier-detection-in-the-aggregated-level.html"><a href="outlier-detection-in-the-aggregated-level.html#median-absolute-deviation-mad"><i class="fa fa-check"></i><b>4.2</b> Median Absolute Deviation (MAD)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="outlier-detection-in-the-aggregated-level.html"><a href="outlier-detection-in-the-aggregated-level.html#example-1"><i class="fa fa-check"></i><b>4.2.1</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="correction-of-main-outlier.html"><a href="correction-of-main-outlier.html"><i class="fa fa-check"></i><b>5</b> Correction of main outlier</a><ul>
<li class="chapter" data-level="5.1" data-path="correction-of-main-outlier.html"><a href="correction-of-main-outlier.html#locally-estimated-scatterplot-smoothing-loess"><i class="fa fa-check"></i><b>5.1</b> Locally Estimated Scatterplot Smoothing (LOESS)</a><ul>
<li class="chapter" data-level="5.1.1" data-path="correction-of-main-outlier.html"><a href="correction-of-main-outlier.html#example-2"><i class="fa fa-check"></i><b>5.1.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="correction-of-main-outlier.html"><a href="correction-of-main-outlier.html#median-weighted-average"><i class="fa fa-check"></i><b>5.2</b> Median weighted average</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fishery: Trade Module</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="correction-of-main-outlier" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Correction of main outlier</h1>
<p>Once the outlier is detected at the aggregated level, the following step is to figure out the transaction values that were responsible for contributing to the outlier. In this project, we use two approaches for attempting to fix the discrepant values detected in the previous step. The first one is a model-based, and the second one is based on the median weighted average.</p>
<p>The choice of approach is based on the number of transactions available on the disaggregated level. If the number of transaction is less than <span class="math inline">\(5\)</span>, then we choose the model-based approach, otherwise the median weighted average is chosen. For instance, in the previous step, the year 2012 was detected as an outlier by the two approaches. When this year is disgregated, there is only one (<span class="math inline">\(n = 1\)</span>) transaction that could be responsible for generating this outlier. In this case, the approach chosen is the model-based, once <span class="math inline">\(n = 1\)</span>.</p>
<div id="htmlwidget-fa4f387fee45a5c4e72d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fa4f387fee45a5c4e72d">{"x":{"filter":"none","caption":"<caption><\/caption>","data":[[76],[1],[2012],["292.9.1.90"],[32890],[2820],[11.6631205673759]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>reporter<\/th>\n      <th>flow<\/th>\n      <th>year<\/th>\n      <th>faocode<\/th>\n      <th>value<\/th>\n      <th>weight<\/th>\n      <th>uv<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","pageLength":13,"columnDefs":[{"className":"dt-right","targets":[0,1,2,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,13,25,50,100],"rowCallback":"function(row, data) {\nDTWidget.formatCurrency(this, row, data, 4, '$', 0, 3, ',', '.', true);\nDTWidget.formatRound(this, row, data, 5, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 6, 2, 3, ',', '.');\nvar value=data[2]; $(row).css({'color':value == 2005.000000 ? '#DDDDDD' : '','background-color':value == 2005.000000 ? '#3B556E' : ''});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
<div id="locally-estimated-scatterplot-smoothing-loess" class="section level2">
<h2><span class="header-section-number">5.1</span> Locally Estimated Scatterplot Smoothing (LOESS)</h2>
<p>To fix the transactions that generated the outlier in the aggregated level is fitted a LOESS model considering the <code>log(uv)</code> as variable response and <code>year</code> as the covariate. The rows which the year was detected as outlier were removed before to fit the model. Once the model is fitted, it is used to predict a new value to the given year. In our example, the year is 2012 and the value predicted by model is 4.701.</p>
<div id="example-2" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Example</h3>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-9"></span>
<img src="bookdown-demo_files/figure-html/unnamed-chunk-9-1.svg" alt="Figure 4: Correction of the outlier using the LOESS model." width="864" />
<p class="caption">
Figure 5.1: Figure 4: Correction of the outlier using the LOESS model.
</p>
</div>
</div>
</div>
<div id="median-weighted-average" class="section level2">
<h2><span class="header-section-number">5.2</span> Median weighted average</h2>
<p>When the number of transactions in the disaggregated level is greater than or equal <span class="math inline">\(5\)</span>, i.e., <span class="math inline">\(n \geq 5\)</span>, the method Median weighted is chosen. In this case, before to apply the correction method we should to identify those/that transactions responsible for generating the outlier. Therefore, the methods to detect outlier mentioned previously are applied in the disaggregated level and then it is possible to identify that/those discrepant transactions.</p>
<p>Once the discrepant transactions are identified the correction is value is computed as following:</p>
<ol style="list-style-type: decimal">
<li>The historical median for <code>uv</code> for each partner is calculated - <span class="math inline">\(M_{hist}\)</span>.</li>
<li>The median for <code>uv</code> for the given year is calculated - <span class="math inline">\(M_{partner}\)</span></li>
<li>The new <code>uv</code> is <span class="math inline">\(uv_{new} = \frac{M_{hist} + M_{partner}}{2}\)</span></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="outlier-detection-in-the-aggregated-level.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
