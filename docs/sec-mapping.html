<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Fishery: Trade Module</title>
  <meta name="description" content="Fisheries Trade Documentation">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Fishery: Trade Module" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/cover.svg" />
  <meta property="og:description" content="Fisheries Trade Documentation" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Fishery: Trade Module" />
  
  <meta name="twitter:description" content="Fisheries Trade Documentation" />
  <meta name="twitter:image" content="img/cover.svg" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
<link rel="prev" href="sec-data.html">
<link rel="next" href="sec-missing.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.10/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>



<link rel="stylesheet" href="ess.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#migration-team"><i class="fa fa-check"></i>Migration Team</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="sec-data.html"><a href="sec-data.html"><i class="fa fa-check"></i><b>1</b> Data</a><ul>
<li class="chapter" data-level="1.1" data-path="sec-data.html"><a href="sec-data.html#unsd---comtrade"><i class="fa fa-check"></i><b>1.1</b> UNSD - COMTRADE</a></li>
<li class="chapter" data-level="1.2" data-path="sec-data.html"><a href="sec-data.html#eurostat"><i class="fa fa-check"></i><b>1.2</b> Eurostat</a></li>
<li class="chapter" data-level="1.3" data-path="sec-data.html"><a href="sec-data.html#tdm-and-other-sources"><i class="fa fa-check"></i><b>1.3</b> TDM and other sources</a></li>
<li class="chapter" data-level="1.4" data-path="sec-data.html"><a href="sec-data.html#data-builder"><i class="fa fa-check"></i><b>1.4</b> Data Builder</a><ul>
<li class="chapter" data-level="1.4.1" data-path="sec-data.html"><a href="sec-data.html#functions"><i class="fa fa-check"></i><b>1.4.1</b> Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="sec-mapping.html"><a href="sec-mapping.html"><i class="fa fa-check"></i><b>2</b> Mapping trade data</a><ul>
<li class="chapter" data-level="2.1" data-path="sec-mapping.html"><a href="sec-mapping.html#definitions"><i class="fa fa-check"></i><b>2.1</b> Definitions</a></li>
<li class="chapter" data-level="2.2" data-path="sec-mapping.html"><a href="sec-mapping.html#mapping-module"><i class="fa fa-check"></i><b>2.2</b> Mapping Module</a></li>
<li class="chapter" data-level="2.3" data-path="sec-mapping.html"><a href="sec-mapping.html#functions-1"><i class="fa fa-check"></i><b>2.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sec-missing.html"><a href="sec-missing.html"><i class="fa fa-check"></i><b>3</b> Missing data</a><ul>
<li class="chapter" data-level="" data-path="sec-missing.html"><a href="sec-missing.html#data-imputation-summary"><i class="fa fa-check"></i>Data imputation summary</a></li>
<li class="chapter" data-level="" data-path="sec-missing.html"><a href="sec-missing.html#imputation-flow"><i class="fa fa-check"></i>Imputation Flow</a></li>
<li class="chapter" data-level="3.1" data-path="sec-missing.html"><a href="sec-missing.html#mathematical-conversion"><i class="fa fa-check"></i><b>3.1</b> Mathematical conversion</a></li>
<li class="chapter" data-level="3.2" data-path="sec-missing.html"><a href="sec-missing.html#partially-agreggation"><i class="fa fa-check"></i><b>3.2</b> Partially Agreggation</a></li>
<li class="chapter" data-level="3.3" data-path="sec-missing.html"><a href="sec-missing.html#methods"><i class="fa fa-check"></i><b>3.3</b> Methods</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sec-missing.html"><a href="sec-missing.html#sec:helper-tables"><i class="fa fa-check"></i><b>3.3.1</b> Helper Tables</a></li>
<li class="chapter" data-level="3.3.2" data-path="sec-missing.html"><a href="sec-missing.html#sec:weight-unit"><i class="fa fa-check"></i><b>3.3.2</b> Estimate weight per unit</a></li>
<li class="chapter" data-level="3.3.3" data-path="sec-missing.html"><a href="sec-missing.html#sec:estimate-uv"><i class="fa fa-check"></i><b>3.3.3</b> Estimate Unit Value</a></li>
<li class="chapter" data-level="3.3.4" data-path="sec-missing.html"><a href="sec-missing.html#sec:impute-partially-aggregation"><i class="fa fa-check"></i><b>3.3.4</b> Imputation by partially reported weight</a></li>
<li class="chapter" data-level="3.3.5" data-path="sec-missing.html"><a href="sec-missing.html#sec:impute-helper-tables"><i class="fa fa-check"></i><b>3.3.5</b> Imputation using the helper tables</a></li>
<li class="chapter" data-level="3.3.6" data-path="sec-missing.html"><a href="sec-missing.html#interpolate-unit-value"><i class="fa fa-check"></i><b>3.3.6</b> Interpolate Unit Value</a></li>
<li class="chapter" data-level="3.3.7" data-path="sec-missing.html"><a href="sec-missing.html#unit-value-total"><i class="fa fa-check"></i><b>3.3.7</b> Unit Value Total</a></li>
<li class="chapter" data-level="3.3.8" data-path="sec-missing.html"><a href="sec-missing.html#interpolate-unit-value-total"><i class="fa fa-check"></i><b>3.3.8</b> Interpolate Unit Value Total</a></li>
<li class="chapter" data-level="3.3.9" data-path="sec-missing.html"><a href="sec-missing.html#global-year-expanded"><i class="fa fa-check"></i><b>3.3.9</b> Global Year Expanded</a></li>
<li class="chapter" data-level="3.3.10" data-path="sec-missing.html"><a href="sec-missing.html#global-year-expanded---hs6"><i class="fa fa-check"></i><b>3.3.10</b> Global Year Expanded - HS6</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sec-missing.html"><a href="sec-missing.html#sec:impute-functions"><i class="fa fa-check"></i><b>3.4</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="outlier-detection.html"><a href="outlier-detection.html"><i class="fa fa-check"></i><b>4</b> Outlier Detection</a><ul>
<li class="chapter" data-level="4.1" data-path="outlier-detection.html"><a href="outlier-detection.html#methods-for-outlier-detection"><i class="fa fa-check"></i><b>4.1</b> Methods for outlier detection</a><ul>
<li class="chapter" data-level="4.1.1" data-path="outlier-detection.html"><a href="outlier-detection.html#boxplot-rule"><i class="fa fa-check"></i><b>4.1.1</b> Boxplot rule</a></li>
<li class="chapter" data-level="4.1.2" data-path="outlier-detection.html"><a href="outlier-detection.html#time-series"><i class="fa fa-check"></i><b>4.1.2</b> Time Series</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="outlier-detection.html"><a href="outlier-detection.html#examples"><i class="fa fa-check"></i><b>4.2</b> Examples</a></li>
<li class="chapter" data-level="4.3" data-path="outlier-detection.html"><a href="outlier-detection.html#boxplot"><i class="fa fa-check"></i><b>4.3</b> Boxplot</a><ul>
<li class="chapter" data-level="4.3.1" data-path="outlier-detection.html"><a href="outlier-detection.html#example"><i class="fa fa-check"></i><b>4.3.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="outlier-detection.html"><a href="outlier-detection.html#locally-estimated-scatterplot-smoothing-loess"><i class="fa fa-check"></i><b>4.4</b> Locally Estimated Scatterplot Smoothing (LOESS)</a><ul>
<li class="chapter" data-level="4.4.1" data-path="outlier-detection.html"><a href="outlier-detection.html#example-1"><i class="fa fa-check"></i><b>4.4.1</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec-mirroring.html"><a href="sec-mirroring.html"><i class="fa fa-check"></i><b>5</b> Trade partners</a><ul>
<li class="chapter" data-level="5.1" data-path="sec-mirroring.html"><a href="sec-mirroring.html#scheda"><i class="fa fa-check"></i><b>5.1</b> Scheda</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a><ul>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#datatables"><i class="fa fa-check"></i>Datatables</a><ul>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#data-built"><i class="fa fa-check"></i>Data built</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#trade-mapping-table"><i class="fa fa-check"></i>Trade mapping table</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#table-to-map-hs-code-to-be-mapped"><i class="fa fa-check"></i>Table to map: HS code to be mapped</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#hs-masterfile"><i class="fa fa-check"></i>HS masterfile</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#cn-masterfile"><i class="fa fa-check"></i>CN Masterfile</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#data-imputed"><i class="fa fa-check"></i>Data imputed</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#data-imputed-and-validated"><i class="fa fa-check"></i>Data imputed and validated</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#outliers-detected"><i class="fa fa-check"></i>Outliers detected</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#outliers-corrected"><i class="fa fa-check"></i>Outliers corrected</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#outliers-validated"><i class="fa fa-check"></i>Outliers validated</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#data-mirrored"><i class="fa fa-check"></i>Data mirrored</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#partnership-mapping-table"><i class="fa fa-check"></i>Partnership mapping table</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#helper-data-tables"><i class="fa fa-check"></i>Helper data tables</a></li>
<li class="chapter" data-level="" data-path="appendix-a.html"><a href="appendix-a.html#data-sources"><i class="fa fa-check"></i>Data sources</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fishery: Trade Module</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec:mapping" class="section level1">
<h1><span class="header-section-number">2</span> Mapping trade data</h1>
<p>In this section, we show how the mapping process is performed under the data built by the user. Commodity codes are reported as HS codes (Harmonized Commodity Description and Coding System) or CN codes for European countries, which are mapped into ISSCFC (FAO Commodity List) codes. This step is performed using some auxiliar tables stored in the SWS.</p>
<div id="definitions" class="section level2">
<h2><span class="header-section-number">2.1</span> Definitions</h2>
<ul>
<li><p><strong>Mappings to be improved:</strong> Data from UNSD data source are often reported at the Tariff Line level, that is, the commodities are country-specific, and hence we have precise information about the description of those commodities. Nevertheless, the link between these codes and ISSCFC codes may be built using only the six first digits of the Tariff Line code, that is, we loss information, so that we may improve these mappings.</p></li>
<li><p><strong>Unmapped</strong>: Commodity code without any correspondent ISSCFC code in the <a href="appendix-a.html#tab:dt-trade-map">Trade Map Table</a>, and also in the master files: <a href="appendix-a.html#tab:dt-hs-masterfile">HS Master file</a> for non-European countries and <a href="appendix-a.html#tab:dt-cn-masterfile">EUCN Master file</a> for European countries.</p></li>
<li><p><strong>Scheda code:</strong> Internal identifier in Commodit Software (old system). Given the combination of a Country | Trade Flow | Fao Group | Tariff line it is generated a sequential code. This code format is the combination between the sequential code and the FAO Group resulting in <em>F.SSSS</em>, where <em>F</em> is the FAO Group and <em>SSSS</em> is the sequential code.</p></li>
</ul>
</div>
<div id="mapping-module" class="section level2">
<h2><span class="header-section-number">2.2</span> Mapping Module</h2>
<p>In Figure <a href="sec-mapping.html#fig:mapping-flow">2.1</a>, we show the mapping module workflow. As all modules are connected , the user will be able to run the Mapping Module only for those countries-year that the data was built. Therefore, the main input data is the data table <a href="appendix-a.html#tab:dt-built-data"><code>fishtrade_data_built</code></a>, and hence the user must query this table by selecting the year and country through the <a href="https://hqlprsws1.hq.un.fao.org:3838/shinyFisheriesTrade_prod/">Fisheries Trade Tool</a>.</p>
<ul>
<li><strong>Inputs:</strong>
<ul>
<li><a href="appendix-a.html#tab:dt-built-data"><code>fishtrade_data_built</code></a></li>
<li><a href="appendix-a.html#tab:dt-trade-map"><code>fishtrade_trade_map</code></a></li>
<li><a href="appendix-a.html#tab:dt-hs-masterfile"><code>hs_masterfile</code></a></li>
<li><a href="appendix-a.html#tab:dt-cn-masterfile"><code>cn_masterfile</code></a></li>
</ul></li>
<li><strong>Parameters:</strong> year, reporter</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:mapping-flow"></span>
<img src="img/mapping_flow.svg" alt="Mapping Module workflow" width="80%" />
<p class="caption">
Figure 2.1: Mapping Module workflow
</p>
</div>
<p>The <a href="appendix-a.html#tab:dt-trade-map">Trade Map Table</a> stores the mapping between Tariff Line and ISSCFC code, which are the mappings developed by the FIAS team. Therefore, we should try to map all data stored in the datatable <a href="appendix-a.html#tab:dt-built-data"><code>fishtrade_data_built</code></a> using this data table. Otherwise, if some commodities code could not be mapped, then we have to use the Master files mappings, which depends on whether the country is European or not.</p>
<p>Figure <a href="sec-mapping.html#fig:mapping-flow">2.1</a> shows the back-end of the Mapping Module, while Figure <a href="sec-mapping.html#fig:mapping-module">2.2</a> shows the front-end. In the left side, we show the buttons which allows us to choose which country and year we wish to run the mapping module. While in the right side, we show the mapping tool with option to add, improve, and complete the mappings. The buttons “Save” and “Update” in the right side are the same that we show in Figure <a href="sec-mapping.html#fig:mapping-flow">2.1</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:mapping-module"></span>
<img src="img/mapping_module.svg" alt="Mapping Module: fron-end" width="100%" />
<p class="caption">
Figure 2.2: Mapping Module: fron-end
</p>
</div>
</div>
<div id="functions-1" class="section level2">
<h2><span class="header-section-number">2.3</span> Functions</h2>
<ul>
<li><a href="https://github.com/SWS-Methodology/faoFisheriesTrade/blob/master/shinyFisheriesTrade_prod/functions/run_mapping_module.R"><strong><code>run_mapping_module</code></strong></a>: It is the main function for the <strong>Mapping Module</strong>.</li>
<li><a href="https://github.com/SWS-Methodology/faoFisheriesTrade/blob/master/shinyFisheriesTrade_prod/functions/get_cn_masterfile.R"><strong><code>get_cn_masterfile</code></strong></a>: It gets the CN masterfile to map European countries.</li>
<li><a href="https://github.com/SWS-Methodology/faoFisheriesTrade/blob/master/shinyFisheriesTrade_prod/functions/get_hs_masterfile.R"><strong><code>get_hs_masterfile</code></strong></a>: It gets the HS masterfile to map non-European countries.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-missing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
