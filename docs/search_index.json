[
["index.html", "Fishery: Trade Module Welcome Migration Team", " Fishery: Trade Module Luís G Silva e Silva and Christian Mongeau Statistician - ESSD - Methodological Innovation Team Welcome This document describes the main institutional actors involved in the migration as well as the FISHERIES TRADE resources (code lists, datasets, data tables) created to support the SWS plugins (R modules) to meet technical unit requirements. Furthermore, the modules are presented in the form of chapters providing a detailed description of their workflows involving input → processing → output as well as results showing whether the modules have lived up to expectations. IMPORTANT: Use the Chrome browser to have a correct vizualization of HTML outputs in this online document. Migration Team Any migration into the SWS requires the interaction between at least three actors: The technical unit interested in automating either some or all its analytical processes in the SWS. The technical unit can be treated as client demanding services from the counterparts responsible for the implementation of its data and statistical assets in the SWS. Therefore, a successful Fisheries Trade migration depends on the coordination between the technical division and other parts. In the Fisheries Trade - SWS migration framework the technical unit is called FIAS and is represented by: Stefania Vannuccini Senior Fishery Officer (FIAS) Adrienne Egger Fishery Officer (FIAS) Barbara Senfter Statistical clerk (FIAS) Thomas Berger Fishery Statistician (FIAS) The ESS - Methodological Innovation Team (ESS - SWS) responsible for the implementation and documentation of the required statistical processes. From the ESS - SWS team the focal points for Fishery Trade - SWS migration are: Carola Fabi Senior Statistician (ESSD) Luís Silva Statistician (ESSD) Christian Mongeau Statistician (ESSD) The CIO - SWS the primary backend and frontend maintainer of the SWS and responsible for the implementation and documentation of non-statistical processes (IT infrastructure). The CIO - SWS team have as interlocutors: Enrico Anello Full Stack Developer (CIO) Matteo Terrinoni Full Stack Developer (CIO) John Rowell Information Technology Officer (CIO) "],
["sec-intro.html", "1 Introduction", " 1 Introduction This document aims to describe the all data process involved in the Fisheries Trade module. "],
["sec-data.html", "2 Data 2.1 UNSD - COMTRADE 2.2 Eurostat 2.3 TDM and other sources 2.4 Data Builder", " 2 Data There are three main data sources for trade data involved in the Fishreries Trade module: UNSD, Eurostat, and TDM. The raw data are harvested by the Statistical Working System Team for both UNSD (Comtrade) and Eurostat by downloading through their API’s respectively, while the data from TDM database is provided by the FIAS. For less than ten countries, we get some information from other sources: FTR, national websites, etc. The frequency of harvesting the trade data needs to be agreed with ESS. There is an effort of the ESS and SWST to provide the user of the trade data a tool that enables users to harvest the data whenever they want. This tool and the process to harvest trade data is currently under development and aim to harvest only data from Comtrade and Eurostat. The other source should be define by FIAS unit. Currently, Comtrade and Eurostat data are stored in different data tables under the domain trade-input-data. The partner of data tables name that store the Comtrade data is “ct_tariffline_unlogged_YYYY”, where YYYY means the respective year, while for the Eurostat is “ce_combinednomenclature_unlogged_YYYY”. The TDM data is stored at data table “fishtrade_tdm_YYYY” under domain Fisheries Commodities. The other sources have the same standard name “fishtrade_other_sources_YYYY” under domain Fisheries Commodities. Altought, there are different data source, the data structure should have the same shape and columns. In Table 2.1 is shown the chapters that must be downloaded to cover all commodities for the Fisheries Trade Module. The chapters were defined and validated by the technical unit. Table 2.1: Chapters considered for Fisheries Trade module Code Description 03 Fish and crustaceans, molluscs and other aquatic invertebrates 05 Animal originated products; not elsewhere specified or included 12 Oil seeds and oleaginous fruits; miscellaneous grains, seeds and fruit, industrial or medicinal plants; straw and fodder 13 Lac; gums, resins and other vegetable saps and extracts 15 Animal or vegetable fats and oils and their cleavage products; prepared animal fats; animal or vegetable waxes 16 Meat, fish or crustaceans, molluscs or other aquatic invertebrates; preparations thereof 21 Miscellaneous edible preparations 23 Food industries, residues and wastes thereof; prepared animal fodder After filtering these chapters, some codes must be excluded, which are those codes that start by 030760 - Snails, Other Than Sea Snails, Live, Fresh, Chilled, Frozen, Dried, Salted Or In Brine or 160558 - Prepared Or Preserved Snails, Other Than Sea Snails. These codes are stored at data table fishtrade_param_hs_exclude under domain Fisheries Commodities. In Table 2.2, we go through the chapter by selecting the commodities which the code starts with the code shown in the table below. In this case, the filter is more specific than the previous one. Table 2.2: Codes considered for Fisheries Trade module Code Description 03 Fish and crustaceans, molluscs and other aquatic invertebrates 0508 Coral and similar materials, unworked or simply prepared, shells of molluscs, crustaceans or echinoderms and cuttle-bone, not cut to shape powder and waste thereof 0509 Sponges, natural; of animal origin 051191 Animal products; of fish or crustaceans, molluscs or other aquatic invertebrates; dead animals of chapter 03, unfit for human consumption 051199 Animal products; n.e.c. in chapter 5 121220 Seaweeds and other algae; of a kind used primarily for human consumption, fresh, chilled, frozen or dried, whether or not ground 130231 Mucilages and thickeners; agar-agar, whether or not modified, derived from vegetable products 1504 Fats and oils and their fractions of fish or marine mammals; whether or not refined, but not chemically modified 1604 Prepared or preserved fish; caviar and caviar substitutes prepared from fish eggs 1605 Crustaceans, molluscs and other aquatic invertebrates, prepared or preserved 210390 Sauces and preparations therefor; mixed condiments and mixed seasonings 230120 Flours, meals and pellets; of fish or of crustaceans, molluscs or other aquatic invertebrates 230990 Dog or cat food; (not put up for retail sale), used in animal feeding 2.1 UNSD - COMTRADE The tariff line data from UNSD contains multiple rows with identical combination of reporter/partner/commodity/flow/year/qunit (unit of quantity). Those are transactions registered separately, thus rows containinig non-missing values and quantities can be aggregated. Missing variables of the same type are also aggregated if they are all missing, as they will produce a missing aggregated value for missing disaggregated values while correctly summing the remaining variables. Commodities at Tariff Line level, i.e., at the national code level. The code is composed by at least six digits up to twelve, where the first six digits follow the Harmonized System, and the other digits are country-specific. The Harmonized System is an international nomenclature for the classification of products. It allows participating countries to classify traded goods on a common basis for customs purposes. At the international level, the Harmonized System (HS) for classifying goods is a six-digit code system. — Harmonized System UNSD Tariff line data reports area code with Tariff line M49 standard (which are different for official M49). The area code is converted in FAO country code using a specific conversion table (unsdpartnersblocks under domain trade-reference-files) provided by Team ENV. Countries that are not supposed to exist in the year for which the module runs are removed from the data (e.g., Serbia did not exist as a single country in 2004). European countries (as reporters) already in Eurostat data are removed. Area codes not mapping to any FAO country code are separately saved and removed from further analyses. All countries mapping to code 252 (which correponds to undefined areas) are mapped to the 896 M49 code (“Other nei”). The flow codes of re-Import (code 4) are recoded into Import (code 1) and codes of re-Export (code 3) are kept. This procedure is applied following UNSD standards: Exports of a country can be distinguished as exports of domestic goods and exports of foreign goods. The second class is generally referred to as re-exports. The exports shown in our database contain both the exports of domestic and foreign goods. Re-exports are exports of foreign goods in the same state as previously imported; they are to be included in the country exports. It is recommended that they be recorded separately for analytical purposes. This may require the use of supplementary sources of information in order to determine the origin of re-exports, i.e., to determine that the goods in question are indeed re-exports rather than the export of goods that have acquired domestic origin through processing. Re-imports are goods imported in the same state as previously exported. They are included in the country imports. It is recommended that they be recorded separately for analytical purposes. This may require the use of supplementary sources of information in order to determine the origin of re-imports, i.e., to determine that the goods in question are indeed re-imports rather than the import of goods that have acquired foreign origin through processing. There are several reasons why an exported good might return to the country of origin. The exported good might be defective, the importer might have defaulted on payments or cancelled the order, the authorities might have imposed an import barrier, or demand or prices in the country of origin might have made it worthwhile to bring the good back. — See http://unstats.un.org/unsd/tradekb/Knowledgebase/Reexports-and-Reimports 2.2 Eurostat Only numeric codes of reporters and partners are kept (letters are not allowed; basically this removes the “EU” total). Only numeric CN8 codes (hs) are kept (letters are not allowed). Only stat_regime equal to 4 is kept. In this system [“Statistical regime 4” or “Total trade”], the recorded aggregates include all goods entering or leaving the economic territory of a country with the exception of simple transit trade. In particular, all goods received into customs warehouses are recorded as imports, regardless of whether they subsequently go into free circulation in the Member State of receipt. Similarly, outgoing goods from customs warehouses are included in the general trade aggregates, at the time they leave the Member State. — See pag. 10 in DG Trade Statistical Guide, July 2019, https://trade.ec.europa.eu/doclib/docs/2013/may/tradoc_151348.pdf Eurostat classifies areas in their geonomenclature. These codes are converted in FAO country codes using a specific conversion table, stored in the SWS, provided by Team B/C. Area codes not mapping to any FAO country code is reported and the records for these area codes are removed. All countries mapping to code 252 (which correpond undefined areas) are mapped to the 896 M49 code (“Other nei”). Commodity codes are reported in CN8 codes (Combined Nomenclature 8 digits). The codes are converted in FCL (FAO Commodity List) codes. Values are converted from EUR to USD using the table, stored in the SWS, with avarage EUR/USD exchange rate for each year provided by Team B/C. 2.3 TDM and other sources The TDM and other sources are processed using the same function that processing the data from Comtrade. Some small adaption should be done to fit well the data from these different data sources. 2.4 Data Builder The Data Builder is a module developed to build the data by choosing the country, year, and data source for each flow (import, export). For example, the user can select the year 2019, Brazil, and TDM for both sources. Given this selection, the data builder will get the raw data from the specific data sources and then process it. The process is composed basically by, renaming columns, filtering chapter, converting M49 codes, and recode variables. After to process the raw data the Data Builder store them in the SWS as the data table fishtrade_built_data under domain “Fisheries Commodities”. In Figure 2.1, we show the data build workflow. The user must select the country, year, and data source, and then the module will save the data built into SWS for being used for the next processes. Once that the user have build and validated the data, the next step is to perform a standardization/mapping. The details are divided between UNSD Tariff line and Eurostat due to the nature of the differences among the two datasets. Figure 2.1: Data builder data flow. 2.4.1 Functions get_tradedata: It is a wrapper function that includes all functions for several data sources. It works like a hub. get_tldata: It gets data from UNSD data source. get_esdata: It gets data from Eurostat data source. get_tdmdata: It gets data from TDM data source In Figure 2.2, we show the schema to build the data, as well as the datatables and domains involved in the process. Figure 2.2: Data builder: functions schema "],
["sec-mapping.html", "3 Mapping trade data 3.1 Definitions 3.2 Mapping Module 3.3 Functions", " 3 Mapping trade data In this section, we show how the mapping process is performed under the data built by the user. Commodity codes are reported as HS codes (Harmonized Commodity Description and Coding System) or CN codes for European countries, which are mapped into ISSCFC (FAO Commodity List) codes. This step is performed using some auxiliar tables stored in the SWS. 3.1 Definitions Mappings to be improved: Data from UNSD data source are often reported at the Tariff Line level, that is, the commodities are country-specific, and hence we have precise information about the description of those commodities. Nevertheless, the link between these codes and ISSCFC codes may be built using only the six first digits of the Tariff Line code, that is, we loss information, so that we may improve these mappings. Unmapped: Commodity code without any correspondent ISSCFC code in the Trade Map Table, and also in the master files: HS Master file for non-European countries and EUCN Master file for European countries. Scheda code: Internal identifier in Commodit Software (old system). Given the combination of a Country | Trade Flow | Fao Group | Tariff line it is generated a sequential code. This code format is the combination between the sequential code and the FAO Group resulting in F.SSSS, where F is the FAO Group and SSSS is the sequential code. 3.2 Mapping Module In Figure 3.1, we show the mapping module workflow. As all modules are connected , the user will be able to run the Mapping Module only for those countries-year that the data was built. Therefore, the main input data is the data table fishtrade_data_built, and hence the user must query this table by selecting the year and country through the Fisheries Trade Tool. Inputs: fishtrade_data_built fishtrade_trade_map hs_masterfile cn_masterfile Parameters: year, reporter Figure 3.1: Mapping Module workflow The Trade Map Table stores the mapping between Tariff Line and ISSCFC code, which are the mappings developed by the FIAS team. Therefore, we should try to map all data stored in the datatable fishtrade_data_built using this data table. Otherwise, if some commodities code could not be mapped, then we have to use the Master files mappings, which depends on whether the country is European or not. Figure 3.1 shows the back-end of the Mapping Module, while Figure 3.2 shows the front-end. In the left side, we show the buttons which allows us to choose which country and year we wish to run the mapping module. While in the right side, we show the mapping tool with option to add, improve, and complete the mappings. The buttons “Save” and “Update” in the right side are the same that we show in Figure 3.1. Figure 3.2: Mapping Module: fron-end 3.3 Functions run_mapping_module: It is the main function for the Mapping Module. get_cn_masterfile: It gets the CN masterfile to map European countries. get_hs_masterfile: It gets the HS masterfile to map non-European countries. "],
["sec-missing.html", "4 Missing data Data imputation summary 4.1 Mathematical conversion 4.2 Partially Agreggation 4.3 Methods 4.4 Functions", " 4 Missing data Data imputation summary Data source: Domain: Fisheries Commodities Input data: fishtrade_built_data The imputation is performed at the partner level, i.e, the shipments are aggregated before the imputation. There are 16 methods to impute the missing weights. 8 methods perform the imputation at Tariff Line level. 8 methods perform the imputation at 6 digits (HS) level. Some automatic imputations can not be achieved. The main reason for this is there is no enough information to execute any method robustly. It is necessary the user’s intervention (manual imputation) 4.1 Mathematical conversion Figure 4.1: Imputation module: mathematical conversions 4.2 Partially Agreggation Figure 4.2: Imputation module: partially aggregation 4.3 Methods 4.3.1 Helper Tables Figure 4.3: Helper Tables: 01 Figure 4.4: Helper Tables: 02 Figure 4.5: Helper Tables: 03 4.3.2 Estimate weight per unit 4.3.2.1 General Approach Figure 4.6: Helper Tables: 03 4.3.2.2 Reporter - Year Figure 4.7: Helper Tables: 03 4.3.2.3 Reporter Figure 4.8: Helper Tables: 03 4.3.2.4 Region-Year Figure 4.9: Helper Tables: 03 4.3.2.5 Global-Year Figure 4.10: Helper Tables: 03 4.3.2.6 Global Figure 4.11: Helper Tables: 03 4.3.3 Estimate Unit Value 4.3.3.1 General Approach Figure 4.12: Helper Tables: 03 4.3.3.2 Reporter - Year Figure 4.13: Helper Tables: 03 4.3.3.3 Region - Year Figure 4.14: Helper Tables: 03 4.3.3.4 Global - Year Figure 4.15: Helper Tables: 03 4.3.4 Imputation by partially reported weight Figure 4.16: Helper Tables: 03 4.3.5 Imputation using the helper tables 4.3.6 Interpolate Unit Value 4.3.7 Unit Value Total 4.3.8 Interpolate Unit Value Total 4.3.9 Global Year Expanded 4.3.10 Global Year Expanded - HS6 4.4 Functions "],
["outlier-detection.html", "5 Outlier Detection 5.1 Data 5.2 Outlier detection in the aggregated level 5.3 Correction of main outlier", " 5 Outlier Detection 5.1 Data The outlier detection methods are applied in the unit value (uv) variable, which is the ratio between the monetary transaction value and its weight. In this first step of this procedure, we attempt to figure out outliers in the aggregate level, and then we try to fix the transactions (disaggregated level) that were responsible for generating the outliers detected. The aggregated level means to compute the unit value by reporter, flow, and FAO code, i.e., for each combination of reporter, flow, and FAO code we calculate the ratio between the summing of the monetary value and the summing of the weight. For instance, in Table 1 is shown a subset from the full data using the following parameters: reporter: 76 year: 2005 flow: 1 faocode: 292.9.1.90 To calculate the unit value in the aggregate level, it is needed to apply the equation below: \\[uv = \\frac{\\sum_{p = 1}^{P} value_p}{\\sum_{p = 1}^{P} weight_p}\\] where \\(value_p\\) is the monetary value from the p-th partner, as well as \\(weight_p\\) is the transaction weight, \\(P\\) is the total of partners in this given combination, in this small example \\(P = 12\\). In order to make this report comprehensible, we show the uv calculation step-by-step as following: \\[\\begin{align} uv &amp; = \\frac{65438+1910 + \\cdots + 44329+438234}{73173+613 + \\cdots + 5949+93719} \\\\ \\\\ &amp; = \\frac{1,893,528}{1,805,531} \\\\ \\\\ &amp; = 1.05 \\end{align}\\] If we repeat it procedure for all available year for this combination, we will find the values shown in Table 2. The highlighted row shows the uv computed previously, as shown in the equations sequence. In Figure 1 is shown the same information stored in Table 1, i.e., the unit value computed in the aggregated level by year. The outlier can be easily identified when we look to the graphic below. The uv seems to be a stable behavior from 2000 to 2011 when you analyze Figure 1. However, in 2012 a sharp increase in the uv is noted. On the other hand, when we look at Figure 2, that is the same information, but without the year 2012, so it is possible to see clearly the increasing trend starting in 2007. Figure 5.1: Figure 1: The whole time series of imports. Figure 5.2: Figure 2: The time series of imports without the year 2012. Despite the visual approach works well to identify the possible outliers, it is not possible to check each graphic to figure out the outliers. Therefore, it needs to use a general rule that can be applied in each combination. In the next section, we show two methods to figure out outliers in the trade data, the first one is the Boxplot, and the second one is the Median Absolute Deviation (MAD). 5.2 Outlier detection in the aggregated level TODO 5.2.1 Boxplot One of the methods to try figured out outlier in the aggregated data is the boxplot rule. Set the coefficient \\(k\\), for instance \\(k = 5\\). Compute the percentiles: 25% (\\(Q_1\\)), and 75% (\\(Q_3\\)). Compute the interquartile range (IQR): \\(IQR = Q_3 - Q_1\\) Compute \\(\\text{limsup} = Q_3 + k \\times IQR\\) Compute \\(\\text{liminf} = Q_1 - k \\times IQR\\) If \\(uv &gt; \\text{limsup} \\mid uv &lt; \\text{liminf}\\), then \\(uv\\) is a outlier. The IQR is a measure of variability, based on dividing a data set into quartiles. Quartiles divide a rank-ordered data set into four equal parts. The values that separate parts are called the first, second, and third quartiles; and they are denoted by Q1, Q2, and Q3, respectively. 5.2.1.1 Example \\(k = 5\\) Compute the percentiles: \\(Q_1 = 1.167\\) \\(Q_3 = 1.788\\) \\(IQR = Q_3 - Q_1 = 0.621\\) \\(\\text{limsup} = 4.893\\) \\(\\text{liminf} = -1.938\\) Figure 5.3: Figure 3: Boxplot exemplifying the outlier detection. 5.2.2 Median Absolute Deviation (MAD) There are many methods for outlier detection, for instance, model-based, quantiles methods, and deviation from average. However, in this task, we are manipulating the massive amount of heterogeneous data grouped in country and commodity class. Therefore, a general and straightforward method can be an excellent choice to perform outlier detection. Given this scenario, the Median Absolute Deviation (MAD) was adopted and applied for each commodity per year. The main idea of this strategy is to find outliers that are away from its median when compared in the same commodity. \\[ z = \\frac{|uv_i - median(uv_i)|}{MAD} \\\\ MAD = median(|uv_i - median(uv_i)|) \\] The steps are as follow: Compute \\(z\\) as shown in the equation above. Compute \\(\\text{limsup} = median(z) + k \\times 1.4826 \\times MAD\\) Compute \\(\\text{liminf} = median(z) - k \\times 1.4826 \\times MAD\\) If \\(z &gt; \\text{limsup} \\mid z &lt; \\text{liminf}\\), then \\(uv\\) is a outlier. 5.2.2.1 Example Compute \\(z\\) as shown in the equation above. Compute \\(\\text{limsup} = 1.22 + 5 \\times 1.4826 \\times 0.25 = 3.07\\) Compute \\(\\text{liminf} = 1.22 - 5 \\times 1.4826 \\times 0.25 = -0.63\\) If \\(z &gt; \\text{limsup} \\mid z &lt; \\text{liminf}\\), then \\(uv\\) is a outlier. Figure 5.4: Figure 4: Outliers detected by the MAD method.. 5.3 Correction of main outlier Once the outlier is detected at the aggregated level, the following step is to figure out the transaction values that were responsible for contributing to the outlier. In this project, we use two approaches for attempting to fix the discrepant values detected in the previous step. The first one is a model-based, and the second one is based on the median weighted average. The choice of approach is based on the number of transactions available on the disaggregated level. If the number of transaction is less than \\(5\\), then we choose the model-based approach, otherwise the median weighted average is chosen. For instance, in the previous step, the year 2012 was detected as an outlier by the two approaches. When this year is disgregated, there is only one (\\(n = 1\\)) transaction that could be responsible for generating this outlier. In this case, the approach chosen is the model-based, once \\(n = 1\\). 5.3.1 Locally Estimated Scatterplot Smoothing (LOESS) To fix the transactions that generated the outlier in the aggregated level is fitted a LOESS model considering the log(uv) as variable response and year as the covariate. The rows which the year was detected as outlier were removed before to fit the model. Once the model is fitted, it is used to predict a new value to the given year. In our example, the year is 2012 and the value predicted by model is 4.701. 5.3.1.1 Example Figure 5.5: Figure 4: Correction of the outlier using the LOESS model. 5.3.2 Median weighted average When the number of transactions in the disaggregated level is greater than or equal \\(5\\), i.e., \\(n \\geq 5\\), the method Median weighted is chosen. In this case, before to apply the correction method we should to identify those/that transactions responsible for generating the outlier. Therefore, the methods to detect outlier mentioned previously are applied in the disaggregated level and then it is possible to identify that/those discrepant transactions. Once the discrepant transactions are identified the correction is value is computed as following: The historical median for uv for each partner is calculated - \\(M_{hist}\\). The median for uv for the given year is calculated - \\(M_{partner}\\) The new uv is \\(uv_{new} = \\frac{M_{hist} + M_{partner}}{2}\\) "],
["sec-mirroring.html", "6 Trade partners", " 6 Trade partners TODO "],
["appendix-a.html", "A Appendix A Datatables", " A Appendix A Datatables Data built Datatable: fishtrade_built_data Domain: Fisheries Commodities Usage: This table is the output from the module Data Builder, and will be used as the input for the Mapping module. In this stage, the data still as raw data because only the countries code have been converted. In Table A.1, we show the description for each field which composed the data table. Table A.1: Columns description for the datatable: fishtrade_built_data Field Description year year with four digits rep Comtrade M49 code for the reporter country prt Comtrade M49 code for the partner country flow Trade flow. Imports(=1), exports (=2), re-imports(=3), re-exports(=4) comm Comodity code. HS commodity code at the Tariff Line level hsrep Commodity Classification value monetary value weight weight in kilogram qty quatity qunit quantity unit hslength number of digits at comm variable src source Trade mapping table The trade mapping table was built by FIAS team in order to store all links between Tariff Line codes and ISSCFC codes. The key variables for the datatable are: rep, flow, tariff_line, isscfc_code, startyear, and endyear. Datatable: fishtrade_trade_map Domain: Fisheries Commodities Usage: This datatable is used in the Mapping Module to atempt to map the Tariff Line code reported by the countries. For some new commodities there is no link to ISSCFC code, in this cases the user is able to update the table through the Mapping Module. Table A.2 shows the description of each field which compose the datatable fishtrade_trade_map under domain Fisheries Commodities. Table A.2: Columns description for the datatable: fishtrade_trade_map Field Description rep Reporter country code country Reporter country name tariff_line Tariff line code tariff_line_descr Tariff line description remark Remarks flow Trade flow scheda Scheda code startyear Start year: the mapping is valid from this year endyear End year: the mapping is valid until thie year isscfc_code Internal code for ISSCFC isscfc_id ISSCFC code isscfc_descr ISSCFC description hs6_use If the HS6 was used to map Table to map: HS code to be mapped This datatable is considered a working table once that is almost a copy from the datatable fishtrade_table_to_map. Datatable: fishtrade_table_to_map Domain: Fisheries Commodities Usage: All missing mapping is store in this data table, and it is also used to save the current status of the mapping by the user. When the user save the mapping in Shiny app, all changes are saved first in this table. If the user decides to update the mapping, then the data from this table is exported to data table fishtrade_trade_map, which stores the final mapping. Table A.3: Columns description for the datatable: fishtrade_table_to_map Field Description rep Reporter country code country Reporter country name tariff_line Tariff line code flow Trade flow isscfc_code ISSCFC code isscfc_id Internal code for ISSCFC tariff_line_descr Tariff line description isscfc_descr ISSCFC description startyear Start year: the mapping is valid from this year endyear End year: the mapping is valid until thie year remark Remarks scheda Scheda code hs6_use If the HS6 was used to map unmapped Flag: True = code not mapped; False = code mapped toimprove Flag: True = code can be improved; False = code mapped at the tariff line code HS masterfile This table is populated through the package faoebx5 which allows us to access all data available in the EBX5 database. It stores the mapping between HS at the six level and the ISSCFC code. Datatable: EBX5 Domain: EBX5 Usage: The table used in the Mapping Module when all links available on the data table fishtrade_trade_map have already been used to map the trade data, but it still missing some codes to be mapped. Therefore, in this case, we should use the mapping at six digits level, hence this must be used. Note that, this is used only for non-European countries. Table A.4: Columns description for the table: hs_masterfile.rds Field Description hs HS code at the 6 digits levels faocode_hs6 ISSCFC code hs2012 Commodity classification HS5 hs2007 Commodity classification HS4 hs2002 Commodity classification HS3 hs1996 Commodity classification HS2 hs1992 Commodity classification HS1 english ISSCFC description CN Masterfile This table is populated through the package faoebx5 which allows us to access all data available in the EBX5 database. It stores the mapping between HS at the CN level (8 digits) and the ISSCFC code. Datatable: EBX5 Domain: EBX5 Usage: The table used in the Mapping Module when all links available on the data table fishtrade_trade_map have already been used to map the trade data, but it still missing some codes to be mapped. Therefore, in this case, we should use the mapping at eight digits level, hence this must be used. Note that, this is used only for European countries. Table A.5: Columns description for the table: eucn_masterfile_latest.rds Field Description CN_Code CN code at the 8 digits levels ISSCFC ISSCFC code NameEn ISSCFC description Data imputed This is the datatable which stores the output from the Imputation Module to be validated by the expert. Datatable: fishtrade_data_imputed Domain: Fisheries Commodities Usage: Once that the data have been mapped, they are used as the input to the Imputation Module, and after the end of this process the data imputed is stored in thie table to be validated by the expert. Table A.6: Columns description for the datatable: fishtrade_data_imputed Field Description year NA rep NA prt NA flow NA comm NA value NA weight NA qty NA qunit NA hslength NA percvanna NA imputation_method NA Data imputed and validated It stores the data imputed and validated by the user. Datatable: fishtrade_data_imputed Domain: Fisheries Commodities Usage: This is almost a copy from the fishtrade_data_imputed datatable, but in this datatable the user is not allowed to change any thing. All changes should be done over the datatable fishtrade_data_imputed, and then can be export to the final data table fishtrade_data_imputed_validated. Table A.7: Columns description for the datatable: fishtrade_data_imputed_validated Field Description year year with four digits rep Comtrade M49 code for the reporter country prt Comtrade M49 code for the partner country flow Trade flow. Imports(=1), exports (=2), re-imports(=3), re-exports(=4) comm Comodity code. HS commodity code at the Tariff Line level value monetary value weight weight in kilogram qty quatity qunit quantity unit hslength number of digits at comm variable imputation_method method used to impute missing data Outliers detected It stores the list of outliers detected as well as the level of aggregation, and criteria used to detect the outlier. Datatable: fishtrade_outliers_detected Domain: Fisheries Commodities Usage: It is one of the outputs of the Outlier detection Module. In this table is stored all outliers detected in this process. Table A.8: Columns description for the datatable: fishtrade_outliers_detected Field Description year Year rep Reporter country flow Trade flow level_aggregation Level of aggregation that the outlier was detected (FAO group, HS2, HS4, HS6, Tariff Line) code_aggregation Code of the aggregation criteria Criteria used to detect the outlier (Unit Value, Weight, Value) value Value USD correction Correction proposed method Method used to detect (boxplot, time series model) checked Flag to inform whether the outlier has been checked validated Flag to inform whether the outlier has been validated (correction proposed has been accepted) Outliers corrected It stores the whole data after pass through the Outlier detection Module with the original value, as well as the proposal correction (automatic) for the outliers detected. This table is a working table, once that the user has to validate the outliers detected and also the correction proposed for them. Datatable: fishtrade_outlier_corrected Domain: Fisheries Commodities Usage: It is one of the outputs of the Outlier detection Module. In this table is stored all data after the outlier detection process with the correction proposed to be accepted or not by the expert. Table A.9: Columns description for the datatable: fishtrade_outlier_corrected Field Description year Year rep Reporter country prt Partner country flow Trade flow fao_group 1-9, A. Defined in EBX under Commodity-&gt;FAOmajor_level2 scheda Internal identifier in Commodit (our old system) for a Country | Trade Flow | Fao Group | Tariff line code combination isscfc_code ISSCFC Code (available in EBX) tariff_line Tariff Line code tariff_line_descr Tariff Line Description isscfc_id Identifier of the ISSCFC code as defined in EBX. value Value in USD weight Weight in kilogram weight_correction Weight after a possible correction value_correction Value after a possible correction weight_method Method used to correct the weight value value_method Method used to correct the monetary value level_agg Level of aggregation which was detected the possible outlier criteria Criteria used to detect the outlier (Unit Value, Weight, Value) accepted Flag for outlier correction. Whether the outlier correction was accepted imputation_method Method used to impute the value. Outliers validated It stores the data after the validation of the expert. Datatable: fishtrade_outlier_validated Domain: Fisheries Commodities Usage: It is one of the outputs of the Outlier detection Module. In this table is stored all data after the outlier detection process with the correction proposed and validated by the expert. Table A.10: Columns description for the datatable: fishtrade_outlier_validated Field Description year Year rep Reporter country prt Partner country flow Trade flow fao_group 1-9, A. Defined in EBX under Commodity-&gt;FAOmajor_level2 scheda Internal identifier in Commodit (our old system) for a Country | Trade Flow | Fao Group | Tariff line code combination isscfc_code ISSCFC Code (available in EBX) tariff_line Tariff Line code tariff_line_descr Tariff Line Description isscfc_id Identifier of the ISSCFC code as defined in EBX. value Value in USD weight Weight in kilogram weight_correction Weight after a possible correction value_correction Value after a possible correction weight_method Method used to correct the weight value value_method Method used to correct the monetary value level_agg Level of aggregation which was detected the possible outlier criteria Criteria used to detect the outlier (Unit Value, Weight, Value) accepted Flag for outlier correction. Whether the outlier correction was accepted imputation_method Method used to impute the value. Data mirrored It stores the whole data after all stages of validation including those countries estimated through the mirroring process. Datatable: fishtrade_mirrored Domain: Fisheries Commodities Usage: It is used to validate the mirroring process. Table A.11: Columns description for the datatable: fishtrade_mirrored Field Description year Year in which the trade occurred rep Reporter country prt Partner country flow Trade flow fao_group FAO major group scheda Scheda code isscfc_code ISSCFC code tariff_line Tariff Line code (National Code) tariff_line_descr Tariff Line descripton isscfc_id Identifier of the ISSCFC code as defined in EBX. value Monetary value in USD weight Weight in kilogram weight_correction Weight after a possible correction value_correction Value after a possible correction weight_method Method used to correct the weight value value_method Method used to correct the monetary value level_agg Level of aggregation which was detected the possible outlier criteria Criteria used to detect the outlier (Unit Value, Weight, Value) accepted Flag for outlier correction. Whether the outlier correction was accepted imputation_method Method used to impute the value. mirrored Flag for mirrored country. Whether the country was estimated through the mirroring process remark Remarks Partnership mapping table The mappings for the countries previously estimated through the mirroring process. The non-reporting countries are labelled est_reporter and the partners are labelled donor. Datatable: fishtrade_partnership_map Domain: Fisheries Commodities Usage: This table is used to retrieve the scheda used in the mirroring process done in the previous years. Table A.12: Columns description for the datatable: fishtrade_partnership_map Field Description est_reporter_code Reporter code estimated through mirroring process est_reporter_flow Flow estimated through mirroring process est_reporter_scheda Scheda est_reporter_remarks Remarks donor_code Donor reporter code donor_tariff_line Tariff Line donated donor_tariff_line_desc Tariff line description donor_isscfc_code ISSCFC code donor_isscfc_id Iternal code for the ISSCFC donor_scheda Scheda donor_flow Flow donated startyear Start year endyear End year Helper data tables Maximum Scheda It stores the maximum scheda for each combination betwee Datatable: fishtrade_max_scheda Domain: Fisheries Commodities Usage: This table is used to retrieve the scheda used in the mirroring process made in the previous years. Table A.13: Columns description for the datatable: fishtrade_max_scheda Field Description rep Reportr country flow Trade flow fao_group FAO major group max_scheda Latest scheda for the combination among reporter, flow, and FAO group. HS blocked to impute It is a list of commodities code to be used in the Imputation Module. Datatable: fishtrade_hs_not_impute Domain: Fisheries Commodities Usage: This codes should not used in the imputation. For example, if a country report the value ($) of the commodity listed in this table, but does not report its weight, then this weight will not imputed. Table A.14: Columns description for the datatable: fishtrade_hs_not_impute Field Description start Start digits HS to exclude It is a list of commodities code to be excluded in the Data Builder Module. Datatable: fishtrade_param_hs_exclude Domain: Fisheries Commodities Usage: This codes should be excluded in the getting data process. Table A.15: Columns description for the datatable: fishtrade_param_hs_exclude Field Description hs_start Start digits HS to filter It is a list of commodities code to be filtered in the Data Builder Module. Datatable: fishtrade_param_hs_filter Domain: Fisheries Commodities Usage: This codes should be filtered in the getting data process. Table A.16: Columns description for the datatable: fishtrade_param_hs_filter Field Description hs_start Start digits HS non fish It is a list of commodities code to be excluded from the Mapping Module. Datatable: fishtrade_param_hs_non_fish Domain: Fisheries Commodities Usage: This codes should be excluded in the mapping process. Table A.17: Columns description for the datatable: fishtrade_param_hs_non_fish Field Description hs_start Start digits Reporter status It shows the current stage for each country built. Datatable: fishtrade_reporter_workflow Domain: Fisheries Commodities Usage: It is used to follow the country-year. Table A.18: Columns description for the datatable: fishtrade_reporter_workflow Field Description year Year associated to the data builder rep Country code - M49 is_built_data Whether the data was built is_run_mapping Whether the mapping process was performed is_mapped_data Whether the mapping process was validated is_run_imputation Whether the imutation process was performed is_imputed_data Whether the imputation process was validated is_run_outlier Whether the outlier detection was performed is_outlier_validated Whether the outlier detection was validated is_run_mirroring Whether the mirroring process was performed is_mirroring_validated Whether the mirroring process was validated Data sources Historical trade data Table A.19: Columns description for the datatable: fishtrade_data_legacy Field Description rep Reporter country flow Trade flow fao_group FAO major group scheda Scheda code. Internal identifier in Commodit (old system) for a Country | Trade Flow | Fao Group | Tariff line code combination year Year (4 digits) in which the trade occured qty Quantity qunit Quantity unit qty_mt Quantity converted in Metric Tons qty_flag Flags for the Quantity : F = Estimate, Blank = Official, - = None, . = Not available value Value as provided by the country value_unit Currency of the value provided by the country value_usd Value converted in thousand USD value_flag Flags for the Value: F = Estimate, Blank = Official, - = None, . = Not available isscfc ISSCFC Code (available in EBX) tariff_line Tariff line code (not always on 12 digits some only have 6 digits) tariff_line_descr National description of the tariff line code remarks Remarks field, in which the user could key in a comment. The remarks field is not year specific so it is the same across all years for a Country | Trade Flow | Fao Group | Tariff line code combination isscfc_id Identifier of the ISSCFC code as defined in EBX. UNSD Eurostat TDM Table A.20: Columns description for the datatable: fishtrade_tdm_data Field Description chapter Commodity chapter rep Reporter country tyear year with four digits curr Currency hsrep Commodity classification flow Trade flow repcurr Reporter currency comm Commodity code prt Partner code weight Wieght in kilograms qty Quantity qunit Quantity unit tvalue Value in USD est Whether the value is estimated ht Other data sources Table A.21: Columns description for the datatable: fishtrade_other_sources Field Description chapter Commodity chapter rep Reporter country tyear year with four digits curr Currency hsrep Commodity classification flow Trade flow repcurr Reporter currency comm Commodity code prt Partner code weight Wieght in kilograms qty Quantity qunit Quantity unit tvalue Value in USD est Whether the value is estimated ht "]
]
